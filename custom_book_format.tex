% ------------------------------------------------------------------------------
% This document is meant to be compiled with tectonic (XeTeX compatible)
%
% I got some ideas from https://www.latextemplates.com/template/ebook-book
% ------------------------------------------------------------------------------
\documentclass[
  10pt,    % font size
  a6paper, % bunko size in Japan (\setstocksize{14.8cm}{10.5cm})
  openany, % a chapter may start on either a recto or verso page
  oneside, % headers and footers are the same for odd and even pages
]{memoir}

\renewcommand\printtoctitle[1]{\itshape\Huge #1}
% see http://www.ctex.org/documents/packages/contents/tocloft.pdf
\renewcommand{\cftpartfont}{\large\itshape}
\renewcommand{\cftpartpagefont}{\large\itshape}

% https://tex.stackexchange.com/a/3000
% https://tex.stackexchange.com/a/482
%  - we shouldn't use inputenc and fontenc
%  - we loose most benefits of microtype (I load it anyway)
\usepackage{microtype}

% --------------------------------------------------
% Font
%
% see:
% 1. fontsquirrel.com/fonts/linux-libertine
% 2. mirrors.ibiblio.org/CTAN/fonts/libertine/doc/libertine.pdf (Section 5)
% 3. ctan.mines-albi.fr/macros/unicodetex/latex/fontspec/fontspec.pdf (Sections 2.2, 4.1)
% --------------------------------------------------
\usepackage{fontspec}
\setmainfont[%
  Extension = .otf,
  UprightFont = *_R,
  ItalicFont = *_RI,
  BoldFont = *_RB,
  BoldItalicFont = *_RBI,
]{LinLibertine}
\usepackage[main=bulgarian, english]{babel}

\usepackage{tikz}
\usepackage{wallpaper}
\usepackage[hidelinks]{hyperref}

\settrimmedsize{\stockheight}{\stockwidth}{*}  % paper = stock (i.e., trim = 0)
\setlrmarginsandblock{30pt}{30pt}{*}
\setulmarginsandblock{30pt}{40pt}{*}
\setheadfoot{\headheight}{\headheight}
\setheaderspaces{*}{0pt}{*}
\setlength{\parindent}{10pt}

% --------------------------------------------------
% footnotes (https://www.overleaf.com/learn/latex/Footnotes)
% --------------------------------------------------
\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\setlength{\footmarkwidth}{0pt} % footnote indentation
\counterwithin*{footnote}{part}

% --------------------------------------------------
% Part formatting
% --------------------------------------------------
\renewcommand{\partnamefont}{\centering\itshape\Huge}
\renewcommand{\partnumfont}{\itshape\Huge}
\renewcommand{\parttitlefont}{\centering\itshape}

% --------------------------------------------------
% Header and footer
% --------------------------------------------------
\makepagestyle{mio}
\setlength{\headwidth}{\textwidth}
\setlength{\headsep}{0.3cm}
\makeheadrule{mio}{\textwidth}{0.1mm}
\makeoddhead{mio}{\scriptsize{\partname\hskip.1cm\thepart\hskip.2cm\vrule\hskip.2cm{\itshape\leftmark}}}{}{}
\makeoddfoot{mio}{}{\scriptsize\thepage}{}
\makeoddfoot{plain}{}{\scriptsize\thepage}{}
\pagestyle{mio}

% --------------------------------------------------
% Quotes
% --------------------------------------------------
\renewenvironment{quote}{\list{}{\em\leftmargin=10pt}\item[]}

% --------------------------------------------------
% Finalize memoir setup
% --------------------------------------------------
% ctan.mines-albi.fr/macros/latex/contrib/memoir/memman.pdf (Section 3.4)
\midsloppy             % very important for reducing overflow
\checkandfixthelayout  % consider memoir change
